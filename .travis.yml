language: node_js
node_js:
  - 7
os:
  - linux
jdk:
  - oraclejdk8
notifications:
  email: false
addons:
  firefox: "49.0"
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - libstdc++-4.9-dev
before_install:
  - wget https://github.com/boot-clj/boot-bin/releases/download/latest/boot.sh
  - mv boot.sh boot && chmod a+x boot && sudo mv boot /usr/local/bin
install:
  - boot
before_script:
  - npm install -g lumo-cljs
  - npm install -g slimerjs
  - chmod a+x scripts/ci/test.sh
script:
  - scripts/ci/test.sh
cache:
  directories:
    - $HOME/.m2
    - $HOME/.boot/cache/lib
    - $HOME/.boot/cache/bin
    - node_modules
    - $(npm config get prefix)/node_modules
    - lumo_cache
env:
  global:
    - BOOT_JVM_OPTIONS= |
      - client
      - XX:+TieredCompilation
      - XX:TieredStopAtLevel=1
      - Xmx2g
      - XX:+UseConcMarkSweepGC
      - XX:+CMSClassUnloadingEnabled
      - Xverify:none
  matrix:
  #  - PLATFORM=clj  TARGET=nil     SELF_HOSTED=nil   OPT=nil
  #  - PLATFORM=cljs TARGET=nodejs  SELF_HOSTED=false OPT=none
  #  - PLATFORM=cljs TARGET=nodejs  SELF_HOSTED=false OPT=simple

  # externs
  # - PLATFORM=cljs TARGET=nodejs  SELF_HOSTED=false OPT=advanced

  # - PLATFORM=cljs TARGET=nodejs  SELF_HOSTED=true  OPT=none

  #
  - PLATFORM=cljs TARGET=browser SELF_HOSTED=false OPT=simple
  # - PLATFORM=cljs TARGET=browser SELF_HOSTED=false OPT=advanced
  # - PLATFORM=cljs TARGET=browser SELF_HOSTED=false OPT=none
  # - PLATFORM=cljs TARGET=browser SELF_HOSTED=true  OPT=none
